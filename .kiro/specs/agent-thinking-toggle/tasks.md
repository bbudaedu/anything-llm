# 實作計劃

- [x] 1. 建立思考過程顯示控制的核心基礎設施


  - 創建 ThinkingToggleContext 用於管理全域狀態和角色檢查
  - 實作 localStorage 備份邏輯（預設關閉）
  - 建立基本的狀態管理 hooks 包含 Admin 權限檢查
  - 整合現有的使用者角色系統
  - _需求: 1.1, 1.2, 4.1, 4.2, 6.1, 6.2_

- [x] 2. 實作思考過程切換按鈕組件







  - [x] 2.1 創建 ThinkingToggleButton 組件（眼睛圖示，僅 Admin 可見）





    - 設計眼睛圖示切換按鈕的 UI 和互動邏輯
    - 實作 Admin 角色權限檢查，非 Admin 使用者不顯示
    - 實作工具提示和無障礙功能
    - 添加適當的眼睛圖示和視覺回饋
    - _需求: 1.1, 1.2, 6.2, 6.3_

  - [x] 2.2 整合眼睛圖示切換按鈕到 PromptInput 區域





    - 將眼睛圖示按鈕添加到現有的 PromptInput 組件中
    - 確保按鈕位置和樣式與現有 UI 一致
    - 實作響應式設計適配
    - 確保只有 Admin 使用者能看到此按鈕
    - _需求: 1.1, 1.2, 6.2_

  - [ ] 2.3 添加鍵盤快捷鍵支援（僅 Admin 可用）
    - 實作 Ctrl/Cmd + Shift + T 快捷鍵
    - 添加快捷鍵提示和說明
    - 確保只有 Admin 使用者可以使用快捷鍵
    - _需求: 1.6, 6.2_

- [x] 3. 增強現有的 ThoughtContainer 組件




  - [ ] 3.1 修改 ThoughtContainer 支援全域思考過程控制
    - 根據全域思考過程顯示狀態調整渲染邏輯
    - 支援 LLM 思考過程和 @agent 模式思考過程的統一控制
    - 保持現有詳細模式的完整功能
    - 確保向後相容性
    - _需求: 1.4, 1.5, 2.1, 2.4, 5.1, 5.2_



  - [ ] 3.2 創建 ProgressIndicator 組件用於思考過程關閉時
    - 設計進度指示器的視覺樣式
    - 實作當前步驟和狀態的顯示邏輯
    - 支援 LLM 思考過程和 @agent 模式的進度顯示
    - 添加載入動畫和狀態轉換效果
    - _需求: 5.1, 5.2, 5.3_

  - [ ] 3.3 實作思考過程關閉時的內容過濾邏輯
    - 從完整思考過程中提取關鍵資訊
    - 實作智慧摘要和步驟識別
    - 支援 LLM 思考過程和 @agent 模式的內容過濾
    - 確保重要錯誤和使用者輸入請求仍然顯示
    - _需求: 5.1, 5.2, 5.3, 5.4_

- [ ] 4. 實作系統設定的後端支援
  - [ ] 4.1 創建系統設定 API（僅 Admin 可存取）
    - 創建新的系統設定端點 `/api/admin/system/thinking-display`
    - 添加 Admin 角色權限驗證中介軟體
    - 實作思考過程顯示設定的讀取和更新邏輯
    - 創建公開的讀取端點 `/api/system/thinking-display`
    - _需求: 1.1, 1.2, 4.1, 4.2, 6.1, 6.2_

  - [ ] 4.2 更新資料庫結構
    - 創建或更新系統設定表
    - 添加思考過程顯示的全域設定欄位
    - 創建資料庫遷移腳本
    - 設定預設值為關閉（false）
    - _需求: 3.1, 3.3_




  - [ ]* 4.3 實作權限驗證和錯誤處理
    - 實作 Admin 角色的權限驗證邏輯
    - 處理非 Admin 使用者的存取嘗試
    - 添加適當的錯誤回應和狀態碼
    - 實作系統設定的載入錯誤處理
    - _需求: 6.1, 6.2, 6.4_

- [ ] 5. 整合所有組件並實作狀態管理
  - [ ] 5.1 將 ThinkingToggleContext 整合到應用程式根層級
    - 在適當的層級包裝 Context Provider
    - 整合使用者角色檢查邏輯
    - 確保狀態在所有相關組件間正確傳遞
    - 實作初始狀態載入邏輯（預設關閉）
    - _需求: 1.1, 1.2, 1.3, 1.6, 6.1, 6.2_

  - [ ] 5.2 實作系統設定的載入和同步
    - 連接前端狀態管理與後端系統設定 API
    - 實作自動載入全域設定邏輯
    - 處理網路錯誤和重試機制
    - 實作 localStorage 備份機制
    - _需求: 4.1, 4.2, 4.4_

  - [ ] 5.3 添加錯誤處理和降級機制
    - 實作錯誤邊界組件
    - 添加權限錯誤和網路錯誤的使用者提示
    - 確保功能在錯誤情況下的優雅降級（預設隱藏思考過程）
    - _需求: 1.1, 1.2, 1.3, 6.4_

- [ ] 6. 實作管理員控制功能
  - [ ] 6.1 整合管理員角色檢查到現有系統
    - 利用現有的使用者角色系統檢查 Admin 權限
    - 確保角色檢查在前端和後端都正確實作
    - 實作角色變更時的即時更新
    - _需求: 6.1, 6.2, 6.4_

  - [ ] 6.2 實作全域設定對所有使用者的影響
    - 確保管理員的設定變更影響所有使用者
    - 實作設定變更的即時生效機制
    - 確保非 Admin 使用者無法修改設定
    - _需求: 1.2, 2.4, 4.4_

- [ ] 7. 優化效能和使用者體驗
  - [ ] 7.1 實作渲染效能優化
    - 使用 React.memo 和 useMemo 優化重新渲染
    - 實作虛擬化處理大量思考內容
    - 優化狀態更新的批次處理
    - 優化角色檢查的效能
    - _需求: 1.6, 5.1, 5.2, 6.4_





  - [ ] 7.2 添加載入狀態和轉場動畫
    - 實作思考過程顯示切換的平滑轉場效果
    - 添加系統設定載入指示器和狀態回饋
    - 優化管理員互動的視覺回饋
    - _需求: 1.6, 5.1, 5.2_


  - [ ]* 7.3 實作無障礙功能增強
    - 添加適當的 ARIA 標籤和角色
    - 實作螢幕閱讀器支援
    - 確保鍵盤導航的完整性
    - 為眼睛圖示添加適當的無障礙標籤
    - _需求: 1.6_

- [ ] 8. 添加國際化支援和最終整合
  - [ ] 8.1 實作多語言文字支援
    - 為所有新增的 UI 文字添加國際化鍵值
    - 更新現有的語言檔案（英文和中文）
    - 確保眼睛圖示工具提示和錯誤訊息的翻譯
    - 添加 Admin 權限相關的訊息翻譯
    - _需求: 1.1, 1.2, 1.3, 1.6_

  - [ ] 8.2 進行最終整合和測試
    - 整合所有功能組件
    - 測試 Admin 和非 Admin 使用者的不同體驗
    - 進行跨瀏覽器相容性測試
    - 驗證所有需求的實作完整性
    - 測試全域設定對所有使用者的影響
    - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 2.1, 2.2, 2.3, 2.4, 3.1, 3.3, 4.1, 4.2, 4.4, 5.1, 5.2, 5.3, 5.4, 6.1, 6.2, 6.3, 6.4_
  - [ ] 3.4 修改 StatusResponse 支援全域思考過程控制（@agent 模式）
    - 整合全域思考過程顯示控制到 @agent 模式
    - 在思考過程關閉時顯示進度指示器
    - 保持原有的展開/摺疊功能
    - 確保與 LLM 思考過程控制的一致性
    - _需求: 1.4, 1.5, 2.1, 2.4, 5.1, 5.2_